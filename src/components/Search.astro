---

---

<div id="search" class="w-full"></div>

<div class="mt-6 pt-6 border-t dark:border-slate-800">
  <h4 class="text-xs font-black uppercase tracking-widest text-slate-400 mb-4">
    热门搜索建议 / Quick Suggestions
  </h4>
  <div class="flex flex-wrap gap-2" id="search-suggestions">
    {
      [
        '45Q',
        'Northern Lights',
        'Sinopec',
        'Hydrogen',
        'China',
        'Norway',
        'Tax Credit',
        'DAC',
        'Standard',
        'EOR',
      ].map((term) => (
        <button class="suggestion-btn px-3 py-1.5 bg-slate-50 dark:bg-slate-800 hover:bg-blue-600 hover:text-white dark:text-slate-300 rounded-full text-xs font-bold transition-all border border-slate-100 dark:border-slate-700">
          {term}
        </button>
      ))
    }
  </div>
</div>

<script>
  const PAGEFIND_CSS_HREF = '/ccus-policy-hub/pagefind/pagefind-ui.css';
  const PAGEFIND_JS_SRC = '/ccus-policy-hub/pagefind/pagefind-ui.js';

  function initSearch() {
    const searchContainer = document.getElementById('search');
    const isEn = document.documentElement.lang === 'en';

    // @ts-ignore
    if (
      searchContainer &&
      !(searchContainer as any)._pagefind_initialized &&
      (window as any).PagefindUI
    ) {
      // @ts-ignore
      new (window as any).PagefindUI({
        element: '#search',
        showImages: false,
        showSubResults: true,
        excerptLength: 30,
        showEmptyFilters: false,
        translations: isEn
          ? {
              placeholder: 'Search policies, facilities or keywords...',
              clear_search: 'Clear',
              load_more: 'Load more results',
              search_label: 'Search',
              filters_label: 'Filters',
              zero_results: 'No results found for [SEARCH_TERM]',
              many_results: '[COUNT] results found for [SEARCH_TERM]',
              one_result: '[COUNT] result found for [SEARCH_TERM]',
              searching: 'Searching for [SEARCH_TERM]...',
            }
          : {
              placeholder: '搜索政策、设施或关键词...',
              clear_search: '清除',
              load_more: '更多结果',
              search_label: '搜索',
              filters_label: '筛选',
              zero_results: '未找到关于 [SEARCH_TERM] 的结果',
              many_results: '找到 [COUNT] 条关于 [SEARCH_TERM] 的结果',
              one_result: '找到 [COUNT] 条关于 [SEARCH_TERM] 的结果',
              alt_search: '未找到结果，显示关于 [SEARCH_TERM] 的替代搜索结果',
              search_suggestion: '您是不是想找 [SEARCH_TERM]？',
              searching: '正在搜索 [SEARCH_TERM]...',
            },
      });
      // @ts-ignore
      searchContainer._pagefind_initialized = true;

      const suggestions = document.getElementById('search-suggestions');
      if (suggestions && !suggestions.hasAttribute('data-suggestions-bound')) {
        suggestions.setAttribute('data-suggestions-bound', '1');
        suggestions.addEventListener('click', (event) => {
          const target = event.target as HTMLElement | null;
          const btn = target?.closest('.suggestion-btn') as HTMLElement | null;
          if (!btn) return;
          const term = btn.innerText;
          const input = document.querySelector(
            '.pagefind-ui__search-input'
          ) as HTMLInputElement;
          if (input) {
            input.value = term;
            input.dispatchEvent(new Event('input', { bubbles: true }));
          }
        });
      }
    }
  }

  function ensurePagefindAssets() {
    // @ts-ignore
    if ((window as any).PagefindUI) {
      initSearch();
      return;
    }

    if (!(window as any).__ccusSearchAssetsRequested) {
      (window as any).__ccusSearchAssetsRequested = true;

      if (!document.querySelector('link[data-pagefind-ui-css]')) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = PAGEFIND_CSS_HREF;
        link.setAttribute('data-pagefind-ui-css', '1');
        document.head.appendChild(link);
      }

      (window as any).__ccusSearchAssetsPromise = new Promise((resolve) => {
        const existingScript = document.querySelector(
          'script[data-pagefind-ui-js]'
        ) as HTMLScriptElement | null;

        if (existingScript) {
          existingScript.addEventListener(
            'load',
            () => {
              resolve(true);
              initSearch();
            },
            { once: true }
          );
          return;
        }

        const script = document.createElement('script');
        script.src = PAGEFIND_JS_SRC;
        script.setAttribute('data-pagefind-ui-js', '1');
        script.onload = () => {
          resolve(true);
          initSearch();
        };
        document.head.appendChild(script);
      });
      return;
    }

    if ((window as any).__ccusSearchAssetsPromise) {
      (window as any).__ccusSearchAssetsPromise.then(() => initSearch());
    }
  }

  ensurePagefindAssets();

  if (!(window as any).__ccusSearchPageLoadBound) {
    document.addEventListener('astro:page-load', ensurePagefindAssets);
    (window as any).__ccusSearchPageLoadBound = true;
  }
</script>

<style is:global>
  :root {
    --pagefind-ui-primary: #2563eb;
    --pagefind-ui-text: #1e293b;
    --pagefind-ui-background: #ffffff;
    --pagefind-ui-border: #e2e8f0;
    --pagefind-ui-tag: #f1f5f9;
  }

  .dark {
    --pagefind-ui-primary: #3b82f6;
    --pagefind-ui-text: #f1f5f9;
    --pagefind-ui-background: #0f172a;
    --pagefind-ui-border: #1e293b;
    --pagefind-ui-tag: #1e293b;
  }

  #search .pagefind-ui__result-link {
    color: #2563eb !important;
    font-weight: 700 !important;
  }

  .dark #search .pagefind-ui__result-link {
    color: #60a5fa !important;
  }

  #search .pagefind-ui__result-excerpt {
    color: #475569 !important;
    font-size: 0.875rem !important;
  }

  .dark #search .pagefind-ui__result-excerpt {
    color: #94a3b8 !important;
  }
</style>
