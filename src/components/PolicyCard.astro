---
import type { CollectionEntry } from 'astro:content';

type PolicyEntry = CollectionEntry<'policies_zh'> | CollectionEntry<'policies_en'>;

interface Props {
  policy: PolicyEntry;
  lang?: 'zh' | 'en';
}

const inferredLang = Astro.currentLocale === 'en' ? 'en' : 'zh';
const { policy, lang = inferredLang } = Astro.props;
const { title, country, year, category, tags, status, description } = policy.data;

const isEn = lang === 'en';
const pureSlug = policy.id;
const href = isEn ? `/en/policy/${pureSlug}` : `/policy/${pureSlug}`;

const categoryColors: Record<string, string> = {
  '经济激励': 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400',
  'Economic Incentives': 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400',
  '法律监管': 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',
  'Legal & Regulatory': 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',
  '市场机制': 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
  'Market Mechanisms': 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
  '战略引导': 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400',
  'Strategic Guidance': 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400',
};
---

<div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-6 hover:shadow-xl transition-all group h-full flex flex-col">
  <div class="flex justify-between items-start mb-4">
    <span class={`text-[10px] font-black uppercase tracking-widest px-2 py-1 rounded ${categoryColors[category] || 'bg-slate-100 text-slate-500'}`}>
      {category}
    </span>
    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{status}</span>
  </div>
  
  <h3 class="text-xl font-black mb-3 group-hover:text-blue-600 dark:text-white transition-colors leading-snug">
    <a href={href}>{title}</a>
  </h3>
  
  <div class="flex items-center gap-3 text-xs font-bold text-slate-500 dark:text-slate-400 mb-4">
    <span class="flex items-center gap-1.5">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>
      {country}
    </span>
    <span>•</span>
    <span>{year}</span>
  </div>
  
  <p class="text-sm text-slate-500 dark:text-slate-400 line-clamp-3 mb-6 leading-relaxed">
    {description}
  </p>
  
  <div class="mt-auto">
    <div class="flex flex-wrap gap-2 mb-4">
      {tags?.slice(0, 3).map(tag => (
        <span class="text-[10px] font-bold text-slate-400 bg-slate-50 dark:bg-slate-800 px-2 py-0.5 rounded border border-slate-100 dark:border-slate-700">
          #{tag}
        </span>
      ))}
    </div>

    <div class="pt-4 border-t dark:border-slate-800 flex items-center justify-between">
      <label class="inline-flex items-center cursor-pointer group/label">
        <input 
          type="checkbox" 
          class="compare-checkbox w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500 transition-all cursor-pointer" 
          data-id={policy.id}
        />
        <span class="ml-2 text-[10px] font-black uppercase tracking-widest text-slate-400 group-hover/label:text-blue-600 transition-colors">
          {isEn ? 'Add to Compare' : '加入对比'}
        </span>
      </label>
      <a href={href} class="text-blue-600 opacity-0 group-hover:opacity-100 transition-all text-xs font-bold flex items-center gap-1">
        {isEn ? 'Details' : '详情'} &rarr;
      </a>
    </div>
  </div>
</div>
