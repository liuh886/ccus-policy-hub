---
---
<div id="search" class="w-full"></div>

<div class="mt-6 pt-6 border-t dark:border-slate-800">
  <h4 class="text-xs font-black uppercase tracking-widest text-slate-400 mb-4">热门搜索建议 / Quick Suggestions</h4>
  <div class="flex flex-wrap gap-2" id="search-suggestions">
    {['45Q', 'Northern Lights', 'Sinopec', 'Hydrogen', 'China', 'Norway', 'Tax Credit', 'DAC', 'Standard', 'EOR'].map(term => (
      <button class="suggestion-btn px-3 py-1.5 bg-slate-50 dark:bg-slate-800 hover:bg-blue-600 hover:text-white dark:text-slate-300 rounded-full text-xs font-bold transition-all border border-slate-100 dark:border-slate-700">
        {term}
      </button>
    ))}
  </div>
</div>

<script>
  function initSearch() {
    const searchContainer = document.getElementById('search');
    // @ts-ignore
    if (searchContainer && !searchContainer._pagefind_initialized && window.PagefindUI) {
      // @ts-ignore
      const pagefind = new window.PagefindUI({
        element: "#search",
        showImages: false,
        showSubResults: true,
        excerptLength: 30,
        showEmptyFilters: false, // 仅显示有结果的过滤器
        translations: {
          placeholder: "搜索政策、设施或关键词...",
          clear_search: "清除",
          load_more: "更多结果",
          search_label: "搜索",
          filters_label: "筛选",
          zero_results: "未找到关于 [SEARCH_TERM] 的结果",
          many_results: "找到 [COUNT] 条关于 [SEARCH_TERM] 的结果",
          one_result: "找到 [COUNT] 条关于 [SEARCH_TERM] 的结果",
          alt_search: "未找到结果，显示关于 [SEARCH_TERM] 的替代搜索结果",
          search_suggestion: "您是不是想找 [SEARCH_TERM]？",
          searching: "正在搜索 [SEARCH_TERM]..."
        }
      });
      // @ts-ignore
      searchContainer._pagefind_initialized = true;

      // Handle suggestions
      document.querySelectorAll('.suggestion-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const term = (btn as HTMLElement).innerText;
          const input = document.querySelector('.pagefind-ui__search-input') as HTMLInputElement;
          if (input) {
            input.value = term;
            input.dispatchEvent(new Event('input', { bubbles: true }));
          }
        });
      });
    }
  }

  // Load Pagefind UI assets
  const link = document.createElement('link');
  link.rel = 'stylesheet';
  link.href = '/pagefind/pagefind-ui.css';
  document.head.appendChild(link);

  const script = document.createElement('script');
  script.src = '/pagefind/pagefind-ui.js';
  script.onload = initSearch;
  document.head.appendChild(script);

  document.addEventListener('astro:page-load', initSearch);
</script>

<style is:global>
  :root {
    --pagefind-ui-primary: #2563eb;
    --pagefind-ui-text: #1e293b;
    --pagefind-ui-background: #ffffff;
    --pagefind-ui-border: #e2e8f0;
    --pagefind-ui-tag: #f1f5f9;
  }

  .dark {
    --pagefind-ui-primary: #3b82f6;
    --pagefind-ui-text: #f1f5f9;
    --pagefind-ui-background: #0f172a;
    --pagefind-ui-border: #1e293b;
    --pagefind-ui-tag: #1e293b;
  }

  #search .pagefind-ui__result-link {
    color: #2563eb !important;
    font-weight: 700 !important;
  }
  
  .dark #search .pagefind-ui__result-link {
    color: #60a5fa !important;
  }
  
  #search .pagefind-ui__result-excerpt {
    color: #475569 !important;
    font-size: 0.875rem !important;
  }

  .dark #search .pagefind-ui__result-excerpt {
    color: #94a3b8 !important;
  }
</style>
